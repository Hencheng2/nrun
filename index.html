<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Web IDE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloud.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.js"></script>
    <!-- JSZip for export/import -->
    <script src="https://cdnjs.cloud.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- FileSaver for export -->
    <script src="https://cdnjs.cloud.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- Pyodide for Python execution -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <style>
        :root {
            --bg-primary: #1e1e1e;
            --bg-secondary: #252526;
            --bg-tertiary: #2d2d30;
            --text-primary: #cccccc;
            --text-secondary: #969696;
            --accent-blue: #007acc;
            --accent-green: #4ec9b0;
            --accent-orange: #ce9178;
            --accent-purple: #c586c0;
            --border-color: #3e3e42;
            --error-red: #f44747;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 15px;
            font-weight: bold;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .file-item {
            padding: 5px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .file-item:hover {
            background-color: var(--bg-tertiary);
        }

        .file-item.active {
            background-color: var(--accent-blue);
            color: white;
        }

        .file-item-content {
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
        }

        .file-delete {
            color: var(--error-red);
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            display: none;
        }

        .file-item:hover .file-delete {
            display: block;
        }

        .file-actions {
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            border-top: 1px solid var(--border-color);
        }

        .btn {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            text-align: center;
            font-size: 13px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-container {
            flex: 1;
            position: relative;
        }

        #editor {
            width: 100%;
            height: 100%;
        }

        /* Right Panel */
        .right-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
        }

        .panel {
            position: relative;
            overflow: hidden;
        }

        .preview-panel {
            flex: 1;
            border-bottom: 1px solid var(--border-color);
        }

        .console-panel {
            height: 30%;
        }

        .panel-header {
            padding: 8px 15px;
            background-color: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-content {
            height: calc(100% - 36px);
            overflow: auto;
        }

        #preview {
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
        }

        #console {
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100%;
            overflow: auto;
        }

        /* Resizable panels */
        .resizer {
            background-color: var(--border-color);
            cursor: col-resize;
            width: 5px;
        }

        .resizer-horizontal {
            background-color: var(--border-color);
            cursor: row-resize;
            height: 5px;
        }

        /* Top bar */
        .top-bar {
            padding: 10px 15px;
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .run-btn {
            background-color: var(--accent-green);
            color: black;
            font-weight: bold;
        }

        /* File icons */
        .file-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            margin-right: 5px;
            background-size: contain;
            background-repeat: no-repeat;
            border-radius: 2px;
        }

        .html-file { background-color: #e44d26; }
        .css-file { background-color: #264de4; }
        .js-file { background-color: #f7df1e; }
        .py-file { background-color: #3776ab; }
        .txt-file { background-color: #888; }
        .json-file { background-color: #f5de19; color: #000; text-align: center; font-weight: bold; }
        .folder-icon { background-color: #7ebae4; }

        /* Hidden file input */
        #fileInput {
            display: none;
        }

        /* Modal for new file creation */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--bg-secondary);
            padding: 20px;
            border-radius: 5px;
            width: 400px;
            max-width: 90%;
        }

        .modal-header {
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 18px;
        }

        .modal-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .modal-option {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
        }

        .modal-option:hover {
            background-color: var(--bg-tertiary);
        }

        .modal-option.selected {
            border-color: var(--accent-blue);
            background-color: rgba(0, 122, 204, 0.2);
        }

        .modal-input {
            width: 100%;
            padding: 8px;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <span>EXPLORER</span>
            </div>
            <div class="file-tree" id="fileTree">
                <!-- Files will be populated here -->
            </div>
            <div class="file-actions">
                <button class="btn" id="newFileBtn">New File</button>
                <button class="btn" id="uploadFileBtn">Upload File</button>
                <input type="file" id="fileInput" multiple>
            </div>
        </div>

        <div class="resizer" id="sidebarResizer"></div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div>
                    <button class="btn run-btn" id="runBtn">Run</button>
                </div>
                <div>
                    <button class="btn" id="exportBtn">Export Project</button>
                    <button class="btn" id="importBtn">Import Project</button>
                </div>
            </div>
            <div class="editor-container">
                <div id="editor"></div>
            </div>
        </div>

        <div class="resizer" id="mainResizer"></div>

        <!-- Right Panel -->
        <div class="right-panel">
            <div class="panel preview-panel">
                <div class="panel-header">
                    <span>Preview</span>
                </div>
                <div class="panel-content">
                    <iframe id="preview"></iframe>
                </div>
            </div>
            <div class="resizer-horizontal" id="previewResizer"></div>
            <div class="panel console-panel">
                <div class="panel-header">
                    <span>Console</span>
                    <button class="btn" id="clearConsoleBtn">Clear</button>
                </div>
                <div class="panel-content">
                    <pre id="console"></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- New File Modal -->
    <div class="modal" id="newFileModal">
        <div class="modal-content">
            <div class="modal-header">Create New File</div>
            <div class="modal-options" id="fileOptions">
                <div class="modal-option selected" data-type="html" data-name="index.html">
                    <strong>HTML File</strong> (index.html) - Web page structure
                </div>
                <div class="modal-option" data-type="css" data-name="style.css">
                    <strong>CSS File</strong> (style.css) - Web page styling
                </div>
                <div class="modal-option" data-type="javascript" data-name="script.js">
                    <strong>JavaScript File</strong> (script.js) - Client-side logic
                </div>
                <div class="modal-option" data-type="python" data-name="main.py">
                    <strong>Python File</strong> (main.py) - Server-side logic
                </div>
                <div class="modal-option" data-type="plaintext" data-name="requirements.txt">
                    <strong>Requirements File</strong> (requirements.txt) - Python dependencies
                </div>
            </div>
            <input type="text" class="modal-input" id="fileNameInput" value="index.html" placeholder="File name">
            <div class="modal-buttons">
                <button class="btn" id="modalCancelBtn">Cancel</button>
                <button class="btn" id="modalCreateBtn">Create</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        const state = {
            files: {},
            currentFile: null,
            pyodide: null,
            isPyodideLoading: false,
            editor: null
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            await initializeMonaco();
            initializeResizers();
            loadFromLocalStorage();
            setupEventListeners();
            initializePyodide();
            updateFileTree();
            
            // Create default files if none exist
            if (Object.keys(state.files).length === 0) {
                createFile('index.html', 'html', `<!DOCTYPE html>
<html>
<head>
    <title>My Web App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Welcome to My Web App</h1>
    <p>This is a sample web application.</p>
    <button id="clickBtn">Click Me!</button>
    
    <script src="script.js"><\/script>
</body>
</html>`);
                
                createFile('style.css', 'css', `body {
    font-family: Arial, sans-serif;
    margin: 40px;
    background: #f0f0f0;
    line-height: 1.6;
}

h1 {
    color: #333;
}

button {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 4px;
}`);
                
                createFile('script.js', 'javascript', `document.addEventListener('DOMContentLoaded', function() {
    const button = document.getElementById('clickBtn');
    
    button.addEventListener('click', function() {
        alert('Button clicked! This is JavaScript in action.');
        console.log('Button was clicked');
    });
    
    console.log('JavaScript loaded successfully');
});`);
                
                createFile('main.py', 'python', `# Simple Python backend example
def main():
    print("Hello from Python backend!")
    return "Python executed successfully"

if __name__ == "__main__":
    result = main()
    print(result)`);
                
                createFile('requirements.txt', 'plaintext', `# Add Python packages here
# numpy==1.24.3
# requests==2.31.0`);
                
                switchToFile('index.html');
            }
        });

        // Initialize Monaco Editor
        async function initializeMonaco() {
            return new Promise((resolve) => {
                // Configure Monaco loader
                require.config({ 
                    paths: { 
                        'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' 
                    } 
                });
                
                // Load Monaco editor
                require(['vs/editor/editor.main'], function() {
                    // Create editor instance
                    state.editor = monaco.editor.create(document.getElementById('editor'), {
                        value: '',
                        language: 'plaintext',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        minimap: { enabled: false },
                        fontSize: 14,
                        wordWrap: 'on'
                    });
                    
                    // Add change listener for autosave
                    state.editor.onDidChangeModelContent(() => {
                        if (state.currentFile) {
                            state.files[state.currentFile].content = state.editor.getValue();
                            saveToLocalStorage();
                            updatePreview();
                        }
                    });
                    
                    resolve();
                });
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            document.getElementById('newFileBtn').addEventListener('click', showNewFileModal);
            document.getElementById('uploadFileBtn').addEventListener('click', () => document.getElementById('fileInput').click());
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            document.getElementById('runBtn').addEventListener('click', runProject);
            document.getElementById('exportBtn').addEventListener('click', exportProject);
            document.getElementById('importBtn').addEventListener('click', () => document.getElementById('fileInput').click());
            document.getElementById('clearConsoleBtn').addEventListener('click', () => document.getElementById('console').textContent = '');
            
            // Modal event listeners
            document.getElementById('modalCancelBtn').addEventListener('click', hideNewFileModal);
            document.getElementById('modalCreateBtn').addEventListener('click', createFileFromModal);
            
            // File option selection
            const options = document.querySelectorAll('.modal-option');
            options.forEach(option => {
                option.addEventListener('click', () => {
                    options.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    document.getElementById('fileNameInput').value = option.getAttribute('data-name');
                });
            });
            
            // Context menu for files
            document.getElementById('fileTree').addEventListener('contextmenu', handleContextMenu);
            document.addEventListener('click', () => {
                const contextMenu = document.querySelector('.context-menu');
                if (contextMenu) contextMenu.remove();
            });
        }

        // Show new file modal
        function showNewFileModal() {
            document.getElementById('newFileModal').style.display = 'flex';
        }

        // Hide new file modal
        function hideNewFileModal() {
            document.getElementById('newFileModal').style.display = 'none';
        }

        // Create file from modal selection
        function createFileFromModal() {
            const selectedOption = document.querySelector('.modal-option.selected');
            const type = selectedOption.getAttribute('data-type');
            let name = document.getElementById('fileNameInput').value.trim();
            
            if (!name) {
                alert('Please enter a file name');
                return;
            }
            
            // Add extension if missing
            if (!name.includes('.')) {
                const ext = selectedOption.getAttribute('data-name').split('.').pop();
                name = `${name}.${ext}`;
            }
            
            // Default content based on file type
            let content = '';
            switch(type) {
                case 'html':
                    content = `<!DOCTYPE html>
<html>
<head>
    <title>New Page</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Hello World</h1>
    <p>Start coding your HTML here</p>
    
    <script src="script.js"><\/script>
</body>
</html>`;
                    break;
                case 'css':
                    content = `/* CSS Styles */
body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 20px;
    background-color: #f4f4f4;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}`;
                    break;
                case 'javascript':
                    content = `// JavaScript code
console.log('Hello from JavaScript!');

document.addEventListener('DOMContentLoaded', function() {
    // Your code here
    console.log('DOM fully loaded and parsed');
});`;
                    break;
                case 'python':
                    content = `# Python code
def main():
    print("Hello from Python!")
    return "Success"

if __name__ == "__main__":
    result = main()
    print(result)`;
                    break;
                case 'plaintext':
                    content = `# Add your Python dependencies here
# One package per line
# Example:
# numpy==1.24.3
# requests==2.31.0`;
                    break;
            }
            
            const filename = createFile(name, type, content);
            switchToFile(filename);
            hideNewFileModal();
        }

        // Create a new file
        function createFile(name, type, content = '') {
            // Ensure unique filename
            let filename = name;
            let counter = 1;
            while (state.files[filename]) {
                const dotIndex = name.lastIndexOf('.');
                if (dotIndex === -1) {
                    filename = `${name} (${counter})`;
                } else {
                    const base = name.substring(0, dotIndex);
                    const ext = name.substring(dotIndex);
                    filename = `${base} (${counter})${ext}`;
                }
                counter++;
            }
            
            state.files[filename] = {
                content: content,
                type: type
            };
            
            saveToLocalStorage();
            updateFileTree();
            return filename;
        }

        // Handle file upload
        function handleFileUpload(event) {
            const files = event.target.files;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const extension = file.name.split('.').pop().toLowerCase();
                    let type = 'plaintext';
                    
                    if (extension === 'html') type = 'html';
                    else if (extension === 'css') type = 'css';
                    else if (extension === 'js') type = 'javascript';
                    else if (extension === 'py') type = 'python';
                    else if (extension === 'json') type = 'json';
                    
                    createFile(file.name, type, e.target.result);
                };
                
                reader.readAsText(file);
            }
            
            // Reset the input
            event.target.value = '';
        }

        // Switch to a file
        function switchToFile(filename) {
            if (!state.files[filename]) return;
            
            state.currentFile = filename;
            const file = state.files[filename];
            
            // Update editor
            state.editor.setValue(file.content);
            
            // Set the appropriate language mode
            let language = 'plaintext';
            if (file.type === 'html') language = 'html';
            else if (file.type === 'css') language = 'css';
            else if (file.type === 'javascript') language = 'javascript';
            else if (file.type === 'python') language = 'python';
            else if (file.type === 'json') language = 'json';
            
            monaco.editor.setModelLanguage(state.editor.getModel(), language);
            
            // Update file tree
            updateFileTree();
        }

        // Delete a file
        function deleteFile(filename) {
            if (!confirm(`Are you sure you want to delete ${filename}?`)) return;
            
            delete state.files[filename];
            
            if (state.currentFile === filename) {
                const remainingFiles = Object.keys(state.files);
                if (remainingFiles.length > 0) {
                    switchToFile(remainingFiles[0]);
                } else {
                    state.currentFile = null;
                    state.editor.setValue('');
                }
            }
            
            saveToLocalStorage();
            updateFileTree();
        }

        // Update file tree display
        function updateFileTree() {
            const fileTree = document.getElementById('fileTree');
            fileTree.innerHTML = '';
            
            Object.keys(state.files).sort().forEach(filename => {
                const file = state.files[filename];
                const fileItem = document.createElement('div');
                fileItem.className = `file-item ${state.currentFile === filename ? 'active' : ''}`;
                
                const fileContent = document.createElement('div');
                fileContent.className = 'file-item-content';
                
                const icon = document.createElement('span');
                icon.className = 'file-icon';
                
                if (file.type === 'html') icon.classList.add('html-file');
                else if (file.type === 'css') icon.classList.add('css-file');
                else if (file.type === 'javascript') icon.classList.add('js-file');
                else if (file.type === 'python') icon.classList.add('py-file');
                else if (file.type === 'json') icon.classList.add('json-file');
                else icon.classList.add('txt-file');
                
                const name = document.createTextNode(filename);
                
                fileContent.appendChild(icon);
                fileContent.appendChild(name);
                
                const deleteBtn = document.createElement('span');
                deleteBtn.className = 'file-delete';
                deleteBtn.innerHTML = '×';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteFile(filename);
                });
                
                fileItem.appendChild(fileContent);
                fileItem.appendChild(deleteBtn);
                
                fileItem.addEventListener('click', () => switchToFile(filename));
                
                fileTree.appendChild(fileItem);
            });
        }

        // Handle context menu for files
        function handleContextMenu(event) {
            const fileItem = event.target.closest('.file-item');
            if (!fileItem) return;
            
            event.preventDefault();
            
            // Remove any existing context menu
            const existingMenu = document.querySelector('.context-menu');
            if (existingMenu) existingMenu.remove();
            
            const filename = fileItem.querySelector('.file-item-content').textContent;
            
            const contextMenu = document.createElement('div');
            contextMenu.className = 'context-menu';
            contextMenu.style.top = `${event.pageY}px`;
            contextMenu.style.left = `${event.pageX}px`;
            
            const deleteOption = document.createElement('div');
            deleteOption.className = 'context-menu-item';
            deleteOption.textContent = 'Delete';
            deleteOption.addEventListener('click', () => deleteFile(filename));
            
            contextMenu.appendChild(deleteOption);
            document.body.appendChild(contextMenu);
        }

        // Initialize Pyodide
        async function initializePyodide() {
            // Check if Pyodide is available
            if (typeof loadPyodide !== 'function') {
                logToConsole('Error: Pyodide failed to load. Please check your internet connection.');
                return;
            }
            
            state.isPyodideLoading = true;
            logToConsole('Loading Pyodide...');
            
            try {
                state.pyodide = await loadPyodide();
                logToConsole('Pyodide loaded successfully.');
            } catch (error) {
                logToConsole('Error loading Pyodide: ' + error.message);
            }
            
            state.isPyodideLoading = false;
        }

        // Run the project
        async function runProject() {
            // Clear console
            document.getElementById('console').textContent = '';
            
            // Update preview
            updatePreview();
            
            // Run Python files if Pyodide is loaded
            if (state.pyodide && !state.isPyodideLoading) {
                await runPythonFiles();
            } else if (!state.pyodide && !state.isPyodideLoading) {
                await initializePyodide();
                if (state.pyodide) await runPythonFiles();
            }
        }

        // Update the preview iframe
        function updatePreview() {
            const preview = document.getElementById('preview');
            let html = '', css = '', js = '';
            
            // Gather HTML, CSS, and JS files
            Object.keys(state.files).forEach(filename => {
                const file = state.files[filename];
                if (file.type === 'html') html += file.content;
                else if (file.type === 'css') css += file.content;
                else if (file.type === 'javascript') js += file.content;
            });
            
            // Create a complete HTML document
            const fullHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>${css}</style>
                </head>
                <body>
                    ${html}
                    <script>${js}<\/script>
                </body>
                </html>
            `;
            
            // Update the iframe
            preview.contentDocument?.write(fullHtml);
            preview.contentDocument?.close();
        }

        // Run Python files
        async function runPythonFiles() {
            let pythonCode = '';
            let hasRequirements = false;
            
            // Gather Python code and check for requirements.txt
            Object.keys(state.files).forEach(filename => {
                const file = state.files[filename];
                if (file.type === 'python') {
                    if (filename === 'requirements.txt') {
                        hasRequirements = true;
                    } else {
                        pythonCode += `# ${filename}\n${file.content}\n\n`;
                    }
                }
            });
            
            if (!pythonCode && !hasRequirements) return;
            
            logToConsole('Running Python code...');
            
            try {
                // Install requirements if needed
                if (hasRequirements && state.files['requirements.txt']) {
                    const requirements = state.files['requirements.txt'].content.split('\n');
                    for (const requirement of requirements) {
                        const packageName = requirement.trim();
                        if (!packageName || packageName.startsWith('#')) continue;
                        
                        logToConsole(`Installing ${packageName}...`);
                        try {
                            await state.pyodide.loadPackage(['micropip']);
                            const micropip = state.pyodide.pyimport('micropip');
                            await micropip.install(packageName);
                            logToConsole(`✓ Installed ${packageName}`);
                        } catch (error) {
                            logToConsole(`✗ Failed to install ${packageName}: ${error.message}`);
                        }
                    }
                }
                
                // Run the Python code
                if (pythonCode) {
                    const result = await state.pyodide.runPythonAsync(pythonCode);
                    if (result !== undefined) {
                        logToConsole(result.toString());
                    }
                    logToConsole('Python execution completed.');
                }
            } catch (error) {
                logToConsole('Python error: ' + error.message);
            }
        }

        // Log to console
        function logToConsole(message) {
            const consoleElem = document.getElementById('console');
            consoleElem.textContent += message + '\n';
            consoleElem.scrollTop = consoleElem.scrollHeight;
        }

        // Export project as ZIP
        async function exportProject() {
            try {
                const zip = new JSZip();
                
                Object.keys(state.files).forEach(filename => {
                    zip.file(filename, state.files[filename].content);
                });
                
                const content = await zip.generateAsync({type: 'blob'});
                saveAs(content, 'project.zip');
                logToConsole('Project exported successfully as project.zip');
            } catch (error) {
                logToConsole('Error exporting project: ' + error.message);
            }
        }

        // Import project from ZIP
        async function importProject(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                const zip = new JSZip();
                const contents = await zip.loadAsync(file);
                
                state.files = {};
                
                for (const filename of Object.keys(contents.files)) {
                    if (contents.files[filename].dir) continue;
                    
                    const content = await contents.files[filename].async('text');
                    const extension = filename.split('.').pop().toLowerCase();
                    let type = 'plaintext';
                    
                    if (extension === 'html') type = 'html';
                    else if (extension === 'css') type = 'css';
                    else if (extension === 'js') type = 'javascript';
                    else if (extension === 'py') type = 'python';
                    else if (extension === 'json') type = 'json';
                    
                    state.files[filename] = {
                        content: content,
                        type: type
                    };
                }
                
                saveToLocalStorage();
                updateFileTree();
                
                const firstFile = Object.keys(state.files)[0];
                if (firstFile) switchToFile(firstFile);
                
                logToConsole('Project imported successfully.');
                
            } catch (error) {
                logToConsole('Error importing project: ' + error.message);
            }
            
            // Reset the input
            event.target.value = '';
        }

        // Save to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('webIDEState', JSON.stringify({
                files: state.files,
                currentFile: state.currentFile
            }));
        }

        // Load from localStorage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('webIDEState');
            if (saved) {
                const data = JSON.parse(saved);
                state.files = data.files || {};
                state.currentFile = data.currentFile;
                
                if (state.currentFile && state.files[state.currentFile]) {
                    switchToFile(state.currentFile);
                }
            }
        }

        // Initialize resizable panels
        function initializeResizers() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const rightPanel = document.querySelector('.right-panel');
            const previewPanel = document.querySelector('.preview-panel');
            const consolePanel = document.querySelector('.console-panel');
            
            // Sidebar resizer
            const sidebarResizer = document.getElementById('sidebarResizer');
            let isSidebarResizing = false;
            
            sidebarResizer.addEventListener('mousedown', (e) => {
                isSidebarResizing = true;
                document.addEventListener('mousemove', resizeSidebar);
                document.addEventListener('mouseup', stopResize);
            });
            
            function resizeSidebar(e) {
                if (!isSidebarResizing) return;
                const containerRect = document.querySelector('.container').getBoundingClientRect();
                const width = Math.min(Math.max(e.clientX - containerRect.left, 150), 400);
                sidebar.style.width = width + 'px';
            }
            
            // Main content resizer
            const mainResizer = document.getElementById('mainResizer');
            let isMainResizing = false;
            
            mainResizer.addEventListener('mousedown', (e) => {
                isMainResizing = true;
                document.addEventListener('mousemove', resizeMain);
                document.addEventListener('mouseup', stopResize);
            });
            
            function resizeMain(e) {
                if (!isMainResizing) return;
                const containerRect = document.querySelector('.container').getBoundingClientRect();
                const width = Math.min(Math.max(e.clientX - containerRect.left - sidebar.offsetWidth, 300), containerRect.width - 300);
                rightPanel.style.width = (containerRect.width - width - sidebar.offsetWidth - 10) + 'px';
            }
            
            // Preview resizer
            const previewResizer = document.getElementById('previewResizer');
            let isPreviewResizing = false;
            
            previewResizer.addEventListener('mousedown', (e) => {
                isPreviewResizing = true;
                document.addEventListener('mousemove', resizePreview);
                document.addEventListener('mouseup', stopResize);
            });
            
            function resizePreview(e) {
                if (!isPreviewResizing) return;
                const rightPanelRect = rightPanel.getBoundingClientRect();
                const height = Math.min(Math.max(e.clientY - rightPanelRect.top, 100), rightPanelRect.height - 100);
                previewPanel.style.flex = `0 0 ${height}px`;
            }
            
            function stopResize() {
                isSidebarResizing = false;
                isMainResizing = false;
                isPreviewResizing = false;
                document.removeEventListener('mousemove', resizeSidebar);
                document.removeEventListener('mousemove', resizeMain);
                document.removeEventListener('mousemove', resizePreview);
            }
        }
    </script>
</body>
</html>
