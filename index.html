<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini IDE - HTML/CSS/JS/Python</title>
<link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/editor/editor.main.css">
<style>
    body { margin:0; font-family: 'Segoe UI', sans-serif; background-color: #1e1e1e; color: #c9d1d9; }
    #editor { width: 70%; height: 80vh; float: left; border-right: 1px solid #333; }
    #console { width: 30%; height: 80vh; float: left; background: #111; color: #0f0; padding: 5px; overflow-y: auto; font-family: monospace; }
    #controls { padding: 10px; background: #111; border-bottom: 1px solid #333; display: flex; gap:10px; align-items:center; }
    button, input { background:#333; color:#c9d1d9; border:none; padding:5px 10px; cursor:pointer; border-radius:4px;}
    button:hover, input:hover { background:#555; }
    #fileList { list-style:none; padding:0; margin:0; max-height: 150px; overflow-y:auto; }
    #fileList li { padding:3px; cursor:pointer; border-bottom:1px solid #222; }
    #fileList li:hover { background:#333; }
</style>
</head>
<body>
<div id="controls">
    <button onclick="newFile('html')">New HTML</button>
    <button onclick="newFile('css')">New CSS</button>
    <button onclick="newFile('js')">New JS</button>
    <button onclick="newFile('py')">New Python</button>
    <button onclick="runCode()">Run</button>
    <input type="file" id="uploadFile" onchange="uploadFile(event)">
</div>
<div id="editor"></div>
<div id="console"></div>
<ul id="fileList"></ul>

<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/loader.js"></script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
<script>
let editor;
let pyodide;
let currentFile = null;
let projectFiles = {}; // filename -> {content, type}

const templates = {
    html: "<!DOCTYPE html>\n<html>\n<head>\n<title>New Page</title>\n</head>\n<body>\n\n</body>\n</html>",
    css: "/* CSS Starter */\nbody {\n    background-color: #1e1e1e;\n    color: #c9d1d9;\n}",
    js: "// JS Starter\nconsole.log('Hello World');",
    py: "# Python Starter\nprint('Hello World')"
};

require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs' }});
require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(document.getElementById('editor'), {
        value: '',
        language: 'javascript',
        theme: 'vs-dark',
        automaticLayout: true,
        fontSize: 14,
        minimap: {enabled: false}
    });
});

async function loadPyodideAndPackages(){
    pyodide = await loadPyodide({indexURL: "https://cdn.jsdelivr.net/pyodide/v0.25.0/full/"});
}
loadPyodideAndPackages();

function newFile(type){
    const name = prompt("Enter file name:") || `file${Object.keys(projectFiles).length+1}.${type}`;
    projectFiles[name] = {content: templates[type], type};
    currentFile = name;
    editor.setValue(projectFiles[name].content);
    monaco.editor.setModelLanguage(editor.getModel(), type==='py'?'python':type);
    refreshFileList();
}

function refreshFileList(){
    const list = document.getElementById('fileList');
    list.innerHTML = '';
    for(let f in projectFiles){
        const li = document.createElement('li');
        li.textContent = f;
        li.onclick = ()=>openFile(f);
        list.appendChild(li);
    }
}

function openFile(name){
    currentFile = name;
    editor.setValue(projectFiles[name].content);
    const langMap = {py:'python', js:'javascript', html:'html', css:'css'};
    monaco.editor.setModelLanguage(editor.getModel(), langMap[projectFiles[name].type]);
}

function uploadFile(event){
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = e=>{
        const ext = file.name.split('.').pop();
        projectFiles[file.name] = {content:e.target.result, type:ext};
        openFile(file.name);
        refreshFileList();
    };
    reader.readAsText(file);
}

async function runCode(){
    const file = projectFiles[currentFile];
    if(!file) return;
    const type = file.type;
    const content = editor.getValue();
    projectFiles[currentFile].content = content;

    const consoleDiv = document.getElementById('console');
    consoleDiv.innerHTML = '';
    if(type==='py'){
        try{
            await pyodide.loadPackagesFromImports(content);
            let output = pyodide.runPython(content);
            consoleDiv.innerText = output!==undefined?output:'Python code executed';
        }catch(e){
            consoleDiv.innerText = e;
        }
    } else if(type==='html' || type==='css' || type==='js'){
        const iframe = document.createElement('iframe');
        iframe.style.width='100%';
        iframe.style.height='100%';
        document.getElementById('console').appendChild(iframe);
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        let html = '';
        html += file.type==='html'?content:'projectFiles['+currentFile+'].content';
        for(let f in projectFiles){
            if(projectFiles[f].type==='css') html+=`<style>${projectFiles[f].content}</style>`;
            if(projectFiles[f].type==='js') html+=`<script>${projectFiles[f].content}<\/script>`;
        }
        doc.open();
        doc.write(html);
        doc.close();
    }
}
</script>
</body>
</html>
